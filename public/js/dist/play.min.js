const socket=io({reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,reconnectionDelayMax:5e3});let myClicks=0,myColor="#00f5d4",myName="",gameStatus="waiting",lastCountdown=null,sessionToken=localStorage.getItem("clickAuctionSession"),_isReconnecting=!1;function saveSession(e){sessionToken=e,localStorage.setItem("clickAuctionSession",e)}function clearSession(){sessionToken=null,localStorage.removeItem("clickAuctionSession")}function showReconnectMessage(e){let t=document.getElementById("reconnectBanner");if(!t){t=document.createElement("div"),t.id="reconnectBanner",t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      padding: 0.75rem;\n      background: linear-gradient(135deg, var(--viooh-purple), var(--viooh-magenta));\n      color: white;\n      text-align: center;\n      font-family: 'Orbitron', sans-serif;\n      font-size: 0.9rem;\n      z-index: 9999;\n      animation: slideDown 0.3s ease;\n    ",document.body.prepend(t);const e=document.createElement("style");e.textContent="\n      @keyframes slideDown {\n        from { transform: translateY(-100%); }\n        to { transform: translateY(0); }\n      }\n    ",document.head.appendChild(e)}t.textContent=e,e.includes("Reconnected")&&setTimeout(()=>{t.style.animation="slideDown 0.3s ease reverse",setTimeout(()=>t.remove(),300)},3e3)}function toggleSound(){const e=SoundManager.toggle(),t=document.getElementById("soundToggle");t.textContent=e?"ðŸ”Š":"ðŸ”‡",t.classList.toggle("muted",!e),e&&(SoundManager.init(),SoundManager.beep(600,.1,"sine",.2))}function joinGame(){const e=document.getElementById("playerName").value.trim()||"Anonymous DSP",t=document.getElementById("adContent").value.trim()||`${e} wins! ðŸŽ‰`;SoundManager.init(),myName=e,socket.emit("joinGame",{name:e,adContent:t}),document.getElementById("joinScreen").classList.add("hidden"),document.getElementById("gameScreen").classList.add("active"),document.getElementById("playerNameDisplay").textContent=e}socket.on("sessionCreated",e=>{saveSession(e.token),Logger.debug("Session created")}),socket.on("rejoinSuccess",e=>{saveSession(e.token),myName=e.playerData.name,myClicks=e.playerData.clicks,myColor=e.playerData.color,document.getElementById("joinScreen").classList.add("hidden"),document.getElementById("gameScreen").classList.add("active"),document.getElementById("playerNameDisplay").textContent=myName,document.getElementById("clickCounter").textContent=myClicks,document.getElementById("errorOverlay").classList.remove("active"),_isReconnecting=!1,Logger.info("Session restored"),showReconnectMessage("Reconnected!")}),socket.on("rejoinError",e=>{Logger.warn("Rejoin failed:",e.message),clearSession(),_isReconnecting=!1,document.getElementById("joinScreen").classList.remove("hidden"),document.getElementById("gameScreen").classList.remove("active")}),socket.on("connect",()=>{Logger.debug("Connected to server"),sessionToken&&(_isReconnecting=!0,socket.emit("rejoinGame",{token:sessionToken}))}),socket.on("disconnect",e=>{Logger.warn("Disconnected:",e),myName&&showReconnectMessage("Connection lost. Reconnecting...")}),document.getElementById("playerName").addEventListener("keypress",e=>{"Enter"===e.key&&joinGame()}),document.getElementById("adContent").addEventListener("keypress",e=>{"Enter"===e.key&&joinGame()});const bidButton=document.getElementById("bidButton");function handleBid(e){if("bidding"!==gameStatus)return;myClicks++,socket.emit("click"),SoundManager.tap();const t=document.getElementById("clickCounter");t.textContent=myClicks,t.classList.add("bump"),setTimeout(()=>t.classList.remove("bump"),50);const n=document.createElement("span");n.className="ripple";const o=bidButton.getBoundingClientRect(),s=(e.clientX||e.touches?.[0]?.clientX||o.width/2)-o.left,i=(e.clientY||e.touches?.[0]?.clientY||o.height/2)-o.top;n.style.left=s+"px",n.style.top=i+"px",n.style.width=n.style.height=Math.max(o.width,o.height)+"px",bidButton.appendChild(n),setTimeout(()=>n.remove(),400)}function updateUI(e){const t=gameStatus;gameStatus=e.status,document.getElementById("bg").className="bg"+("bidding"===e.status?" bidding":"");const n=document.getElementById("gameStatusBadge");n.className="game-status-badge status-"+e.status,n.textContent=e.status.charAt(0).toUpperCase()+e.status.slice(1),"countdown"===e.status?lastCountdown!==e.timeRemaining&&(lastCountdown=e.timeRemaining,SoundManager.countdownTick()):"bidding"===e.status&&"bidding"!==t&&SoundManager.go(),document.getElementById("errorOverlay").classList.remove("active"),"waiting"===e.status?(bidButton.className="bid-button waiting",bidButton.textContent="Waiting...",bidButton.disabled=!0):"countdown"===e.status?(bidButton.className="bid-button countdown-state",bidButton.innerHTML=`<span style="font-size: 3rem;">${e.timeRemaining}</span><br>GET READY`,bidButton.disabled=!0,myClicks=0,document.getElementById("clickCounter").textContent="0"):"bidding"===e.status?(bidButton.className="bid-button ready",bidButton.innerHTML=e.timeRemaining<=3?`<span style="font-size: 2rem; color: #ff3366;">${e.timeRemaining}s</span><br>BID!`:"BID!",bidButton.disabled=!1):"finished"===e.status&&(bidButton.className="bid-button disabled",bidButton.textContent="Done",bidButton.disabled=!0);const o=e.leaderboard.find(e=>e.name===myName);o&&(myColor=o.color,document.getElementById("playerColorDot").style.background=myColor);const s=document.getElementById("winnerOverlay");if("finished"===e.status){if(e.winner){const t=e.winner.name===myName,n=e.leaderboard.findIndex(e=>e.name===myName)+1,o=e.leaderboard.length;s.className="winner-overlay active"+(t?" you-won":""),t?SoundManager.winner():SoundManager.end(),t?(document.getElementById("winnerTrophy").textContent="ðŸ†",document.getElementById("winnerTitle").textContent="YOU WON!",document.getElementById("yourResult").style.display="none"):2===n?(document.getElementById("winnerTrophy").textContent="ðŸ¥ˆ",document.getElementById("winnerTitle").textContent="2nd Place!",document.getElementById("yourResult").style.display="block"):3===n?(document.getElementById("winnerTrophy").textContent="ðŸ¥‰",document.getElementById("winnerTitle").textContent="3rd Place!",document.getElementById("yourResult").style.display="block"):(document.getElementById("winnerTrophy").textContent="ðŸ“Š",document.getElementById("winnerTitle").textContent="Results",document.getElementById("yourResult").style.display="block"),document.getElementById("winnerNameBig").textContent=e.winner.name+" wins!",document.getElementById("winnerClicksBig").textContent=e.winner.clicks+" clicks",document.getElementById("yourResultValue").textContent=myClicks+" clicks",document.getElementById("yourRank").textContent=n>0?`You placed #${n} of ${o}`:"",document.getElementById("yourResultLabel").textContent=t?"":"Your Score"}}else s.className="winner-overlay"}bidButton.addEventListener("click",handleBid),bidButton.addEventListener("touchstart",e=>{e.preventDefault(),handleBid(e)}),bidButton.addEventListener("touchend",e=>e.preventDefault()),socket.on("gameState",updateUI),socket.on("joinError",e=>{document.getElementById("errorText").textContent=e.message||"Could not join the game",document.getElementById("errorOverlay").classList.add("active")}),document.getElementById("playerName").focus(),window.joinGame=joinGame,window.toggleSound=toggleSound;