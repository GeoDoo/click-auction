const socket=io();let maxClicks=1,lastCountdown=null,lastStatus="waiting";function loadAllTimeStats(){fetch("/api/stats").then(e=>e.json()).then(e=>{const t=document.getElementById("allTimeList");e.allTime&&0!==e.allTime.length?t.innerHTML=e.allTime.slice(0,8).map((e,t)=>`\n            <div class="leaderboard-item">\n              <div class="rank">${0===t?"ğŸ¥‡":1===t?"ğŸ¥ˆ":2===t?"ğŸ¥‰":t+1}</div>\n              <div class="player-name">${escapeHtml(e.name)}</div>\n              <div class="player-stats">\n                <span class="wins">${e.wins} ğŸ†</span>\n                <span class="best">Best: ${e.bestRound}</span>\n              </div>\n            </div>\n          `).join(""):t.innerHTML='<div class="empty-leaderboard"><div class="icon">ğŸ†</div><div>No champions yet...</div></div>'}).catch(e=>Logger.warn("Could not load all-time stats:",e))}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function updateUI(e){document.getElementById("bg").className="bg"+("bidding"===e.status?" bidding":""),document.getElementById("roundBadge").textContent=`Round ${e.round}`;const t=document.getElementById("statusBadge");t.className="status-badge status-"+e.status;t.textContent={waiting:"Waiting",countdown:"Starting...",bidding:"LIVE!",finished:"Complete"}[e.status]||e.status;const n=document.getElementById("countdownOverlay"),a=document.getElementById("countdownNumber");"waiting"===e.status?n.className="countdown-overlay":"countdown"===e.status?(n.className="countdown-overlay active",a.textContent=e.timeRemaining,lastCountdown!==e.timeRemaining&&(lastCountdown=e.timeRemaining,SoundManager.countdownTick(),a.style.animation="none",a.offsetHeight,a.style.animation="countdown-pop 1s ease-out")):"bidding"===e.status?(n.className="countdown-overlay","bidding"!==lastStatus&&SoundManager.go()):"finished"===e.status&&(n.className="countdown-overlay"),document.getElementById("playerCount").textContent=e.playerCount,e.leaderboard.length>0&&(maxClicks=Math.max(maxClicks,e.leaderboard[0].clicks));const o=document.getElementById("leaderboardList");0===e.leaderboard.length?o.innerHTML='<div class="empty-leaderboard"><div class="icon">ğŸ‘¥</div><div>Waiting for DSPs to join...</div></div>':o.innerHTML=e.leaderboard.slice(0,10).map((e,t)=>`\n          <div class="leaderboard-item">\n            <div class="rank">${0===t?"ğŸ¥‡":1===t?"ğŸ¥ˆ":2===t?"ğŸ¥‰":t+1}</div>\n            <div class="player-color" style="background: ${e.color}"></div>\n            <div class="player-name">${escapeHtml(e.name)}</div>\n            <div class="player-clicks">${e.clicks}</div>\n            <div class="click-bar" style="width: ${maxClicks>0?e.clicks/maxClicks*100:0}%; background: ${e.color}"></div>\n          </div>\n        `).join("");const i=document.getElementById("winnerScreen");"finished"===e.status&&e.leaderboard.length>0?(showWinnerScreen(e),i.className="winner-screen active",createConfetti(),"finished"!==lastStatus&&(SoundManager.winner(),setTimeout(loadAllTimeStats,1e3))):i.className="winner-screen",lastStatus=e.status}function showWinnerScreen(e){const t=e.leaderboard,n=t[0];document.getElementById("winnerName").textContent=n?n.name:"-",document.getElementById("winnerScoreText").textContent=n?`${n.clicks} clicks â€¢ Round ${e.round} Champion`:"",document.getElementById("adContent").textContent=e.winnerAd?`"${e.winnerAd}"`:'"We Won! ğŸ‰"',document.getElementById("adAuthor").textContent=n?`â€” ${n.name}`:"",document.getElementById("podiumRound").textContent=e.round;for(let e=1;e<=3;e++){const n=t[e-1];document.getElementById(`podiumName${e}`).textContent=n?n.name:"-",document.getElementById(`podiumScore${e}`).textContent=n?`${n.clicks} clicks`:"0"}}function createConfetti(){const e=["#00C9A7","#E91E8C","#6B3FA0","#FFD700","#00E896","#FF3366"],t=document.getElementById("winnerScreen");t.querySelectorAll(".confetti").forEach(e=>e.remove());for(let n=0;n<100;n++){const n=document.createElement("div");n.className="confetti";const a=200*(Math.random()-.5);n.style.cssText=`\n      position: fixed;\n      width: ${10*Math.random()+5}px;\n      height: ${10*Math.random()+5}px;\n      background: ${e[Math.floor(Math.random()*e.length)]};\n      left: ${100*Math.random()}%;\n      top: -20px;\n      opacity: 1;\n      transform: rotate(${360*Math.random()}deg);\n      --drift: ${a}px;\n      animation: confetti-fall ${2*Math.random()+2}s linear forwards;\n      animation-delay: ${1.5*Math.random()}s;\n      z-index: 1000;\n      pointer-events: none;\n    `,t.appendChild(n),setTimeout(()=>n.remove(),5e3)}}fetch("/api/config").then(e=>e.json()).then(e=>{const t=e.baseUrl+"/play";document.getElementById("joinUrl").textContent=t,document.getElementById("joinQr").src=`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(t)}&bgcolor=ffffff&color=0a0b1e&margin=5`}).catch(()=>{const e=window.location.origin+"/play";document.getElementById("joinUrl").textContent=e,document.getElementById("joinQr").src=`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(e)}&bgcolor=ffffff&color=0a0b1e&margin=5`}),loadAllTimeStats(),setInterval(loadAllTimeStats,1e4),socket.on("gameState",updateUI),socket.on("clickUpdate",e=>{maxClicks=Math.max(maxClicks,e.clicks)});